<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Series Complete for Plex - Series Analyzer</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="favicon.svg">
    
    <!-- Tailwind CSS Play CDN -->
    <script src="https://cdn.tailwindcss.com/3.4.15"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Modern Design System 2026 - Emerald Green -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // Primary - Emerald Green
                        'primary': {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b'
                        },
                        // Neutral - Dark Theme
                        'surface': {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                            950: '#0a0a0a'
                        },
                        // Legacy aliases (for compatibility)
                        'app-dark': '#111827',
                        'app-darker': '#0a0a0a',
                        'app-gray': '#374151',
                        'app-light': '#9ca3af',
                        'app-white': '#f9fafb'
                    },
                    fontFamily: {
                        'sans': ['SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif']
                    },
                    backdropBlur: {
                        'xs': '2px',
                        'glass': '20px'
                    },
                    borderRadius: {
                        'glass': '16px',
                        '2xl': '1rem',
                        '3xl': '1.5rem'
                    }
                }
            }
        }
    </script>
    
    <style>
        /* ========================================
           Modern Design System 2026
           Glass Morphism + Emerald Green
           ======================================== */

        /* Base */
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #111827 50%, #0f172a 100%);
            min-height: 100vh;
        }

        /* Glass Effect - Apple Liquid Glass 2026 */
        .glass-effect {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.08) 0%,
                rgba(255, 255, 255, 0.03) 100%
            );
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .glass-card {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.06) 0%,
                rgba(255, 255, 255, 0.02) 100%
            );
            backdrop-filter: blur(16px) saturate(150%);
            -webkit-backdrop-filter: blur(16px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            box-shadow:
                0 4px 24px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        /* Primary Button - Emerald */
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        }

        /* Secondary Button */
        .btn-secondary {
            background: rgba(55, 65, 81, 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(75, 85, 99, 0.9);
            border-color: rgba(16, 185, 129, 0.5);
        }

        /* Series Card */
        .series-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.06);
            will-change: transform;
            contain: layout style paint;
        }

        .series-card:hover {
            transform: translateY(-4px) scale(1.01);
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(16, 185, 129, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Virtual scrolling container */
        #series-grid {
            contain: layout style;
        }

        /* Status Colors */
        .status-complete { color: #34d399; }
        .status-warning { color: #fbbf24; }
        .status-critical { color: #f87171; }
        .status-unknown { color: #9ca3af; }

        /* Filter Button Active State - iOS Segmented Control Style */
        .filter-btn {
            position: relative;
            z-index: 1;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .filter-btn:not(.active):hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Input Focus States */
        input:focus, select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        /* Progress Bar */
        .progress-bar {
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
        }

        /* Loading Spinner */
        .spinner {
            border-color: rgba(16, 185, 129, 0.2);
            border-top-color: #10b981;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(17, 24, 39, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(55, 65, 81, 0.8);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #10b981;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .series-card:hover {
                transform: none;
            }

            .btn-primary:hover,
            .btn-secondary:hover {
                transform: none;
            }

            header .container {
                padding: 0.75rem;
            }

            header h1 {
                font-size: 1.25rem;
            }

            #stat-series, #stat-complete, #stat-incomplete {
                font-size: 1rem;
            }

            .btn-primary, .btn-secondary {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }

            /* Filter Segmented Control - Horizontal Scroll on Mobile */
            .filter-btn {
                white-space: nowrap;
                flex-shrink: 0;
            }

            /* Allow horizontal scroll for filter container */
            .inline-flex:has(.filter-btn) {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                max-width: 100%;
            }

            .inline-flex:has(.filter-btn)::-webkit-scrollbar {
                display: none;
            }

            .series-card {
                padding: 1rem;
            }

            #pagination-controls {
                font-size: 0.875rem;
                padding: 0 0.5rem;
            }

            #pagination-controls button {
                padding: 0.5rem;
                min-width: 2.5rem;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .filter-btn span {
                display: none;
            }

            .filter-btn i {
                margin: 0;
            }

            .filter-btn {
                padding: 0.5rem 0.75rem;
            }
        }

        /* Tablet Responsive */
        @media (min-width: 769px) and (max-width: 1024px) {
            header .container {
                padding: 1rem;
            }

            .series-card {
                padding: 1.25rem;
            }
        }

        /* Lucide Icon Styles */
        .lucide {
            width: 1.25rem;
            height: 1.25rem;
            stroke-width: 2;
        }

        .lucide-sm {
            width: 1rem;
            height: 1rem;
        }

        .lucide-lg {
            width: 1.5rem;
            height: 1.5rem;
        }

        /* Legacy compatibility classes */
        .plex-button { @apply btn-primary; }
        .plex-dark { background-color: #111827; }
        .plex-darker { background-color: #0a0a0a; }
        .plex-gray { background-color: #374151; }
        .text-plex-white { color: #f9fafb; }
        .text-plex-light { color: #9ca3af; }
        .bg-plex-darker { background-color: #0a0a0a; }
        .bg-plex-gray { background-color: #374151; }
        .border-plex-gray { border-color: #374151; }
    </style>
</head>
<body class="font-sans text-app-white min-h-screen">
    <!-- Header -->
    <header class="glass-effect sticky top-0 z-50 border-b border-white/10">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center">
                        <i data-lucide="tv" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Series Complete</h1>
                        <p class="text-xs text-surface-400">Plex Library Analyzer</p>
                    </div>
                </div>

                <!-- Stats -->
                <div class="hidden sm:flex items-center space-x-4 md:space-x-8">
                    <div class="text-center">
                        <div class="text-xl md:text-2xl font-bold text-primary-400" id="stat-series">0</div>
                        <div class="text-xs text-surface-400">Series</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl md:text-2xl font-bold text-emerald-400" id="stat-complete">0</div>
                        <div class="text-xs text-surface-400">Complete</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl md:text-2xl font-bold text-amber-400" id="stat-incomplete">0</div>
                        <div class="text-xs text-surface-400">Incomplete</div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <button id="scan-library-btn" class="btn-primary px-3 sm:px-6 py-2 sm:py-2.5 rounded-xl flex items-center space-x-1 sm:space-x-2" title="Scan your Plex library for TV series">
                        <i id="scan-icon" data-lucide="database" class="w-4 sm:w-5 h-4 sm:h-5"></i>
                        <div id="scan-spinner" class="hidden animate-spin rounded-full h-4 sm:h-5 w-4 sm:w-5 border-2 border-white/30 border-t-white"></div>
                        <span id="scan-text" class="hidden sm:inline">Scan Library</span>
                        <span id="scan-text-short" class="sm:hidden">Scan</span>
                    </button>

                    <button id="analyze-all-btn" class="btn-primary px-6 py-2.5 rounded-xl flex items-center space-x-2 hidden" title="Analyze all series for missing episodes">
                        <i data-lucide="clipboard-list" class="w-5 h-5"></i>
                        <span>Analyze All</span>
                    </button>

                    <button id="refresh-cache-btn" class="btn-secondary p-2.5 rounded-xl" title="Reload from cache">
                        <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                    </button>

                    <button id="insights-btn" class="btn-secondary px-3 sm:px-4 py-2.5 rounded-xl flex items-center space-x-2" title="View library insights and statistics">
                        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                        <span class="hidden sm:inline text-sm font-medium">Insights</span>
                    </button>

                    <button id="settings-btn" class="btn-secondary p-2.5 rounded-xl" title="Open application settings">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Search and Filters - Apple Style -->
        <div class="space-y-4 mb-8">

            <!-- Row 1: Search Bar -->
            <div class="relative">
                <i data-lucide="search" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-surface-400 pointer-events-none"></i>
                <input type="text" id="search-input" placeholder="Search series..."
                       class="w-full h-12 pl-12 pr-4 bg-surface-800/60 backdrop-blur-xl rounded-2xl text-white placeholder-surface-400 border border-white/10 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-all text-base">
            </div>

            <!-- Row 2: Segmented Filter Control -->
            <div class="flex flex-col sm:flex-row gap-3">
                <!-- Filter Segments - iOS Style -->
                <div class="inline-flex p-1 bg-surface-800/60 backdrop-blur-xl rounded-xl border border-white/10 flex-shrink-0">
                    <button data-filter="all" class="filter-btn active px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2">
                        <i data-lucide="layers" class="w-4 h-4"></i>
                        <span>All</span>
                    </button>
                    <button data-filter="complete" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-surface-300 hover:text-white">
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        <span>Complete</span>
                    </button>
                    <button data-filter="incomplete" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-surface-300 hover:text-white">
                        <i data-lucide="circle-dot" class="w-4 h-4"></i>
                        <span>Incomplete</span>
                    </button>
                    <button data-filter="critical" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-surface-300 hover:text-white">
                        <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">Critical</span>
                    </button>
                </div>

                <!-- Spacer -->
                <div class="flex-1"></div>

                <!-- Action Buttons -->
                <div class="flex gap-2">
                    <button id="advanced-search-btn"
                            class="h-10 px-4 bg-surface-800/60 backdrop-blur-xl text-white rounded-xl border border-white/10 hover:border-primary-500/50 hover:bg-surface-700/60 transition-all text-sm font-medium flex items-center gap-2">
                        <i data-lucide="sliders-horizontal" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">Filters</span>
                    </button>
                    <button id="export-btn"
                            class="h-10 px-4 bg-surface-800/60 backdrop-blur-xl text-white rounded-xl border border-white/10 hover:border-sky-500/50 hover:bg-sky-600/20 transition-all text-sm font-medium flex items-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">Export</span>
                    </button>
                </div>
            </div>

            <!-- Row 3: Sort Controls -->
            <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center">
                <div class="flex items-center gap-3">
                    <span class="text-surface-400 text-sm font-medium">Sort:</span>
                    <select id="sort-select"
                            class="h-10 bg-surface-800/60 backdrop-blur-xl text-white text-sm px-4 pr-10 rounded-xl border border-white/10 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 outline-none appearance-none cursor-pointer"
                            style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%239ca3af%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3e%3cpolyline points=%276 9 12 15 18 9%27%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px;">
                        <option value="name-asc">Name (A-Z)</option>
                        <option value="name-desc">Name (Z-A)</option>
                        <option value="completion-desc">Completion ↓</option>
                        <option value="completion-asc">Completion ↑</option>
                        <option value="episodes-desc">Episodes ↓</option>
                        <option value="episodes-asc">Episodes ↑</option>
                        <option value="year-desc">Year (Newest)</option>
                        <option value="year-asc">Year (Oldest)</option>
                        <option value="quality-desc">Quality ↓</option>
                        <option value="missing-desc">Missing ↓</option>
                        <option value="missing-asc">Missing ↑</option>
                    </select>
                </div>

                <button id="advanced-sort-btn"
                        class="h-10 px-4 bg-surface-800/60 backdrop-blur-xl text-surface-300 hover:text-white rounded-xl border border-white/10 hover:border-white/20 transition-all text-sm font-medium flex items-center gap-2">
                    <i data-lucide="settings-2" class="w-4 h-4"></i>
                    <span>More Options</span>
                </button>
            </div>

            <!-- Advanced Sort Panel (Hidden by default) -->
            <div id="advanced-sort-panel" class="hidden">
                <div class="p-4 bg-surface-800/40 backdrop-blur-xl rounded-2xl border border-white/10">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="space-y-2">
                            <label class="text-surface-400 text-xs font-medium uppercase tracking-wide">Group by</label>
                            <select id="group-by-select"
                                    class="w-full h-10 bg-surface-900/60 text-white text-sm px-3 rounded-xl border border-white/10 focus:border-primary-500 outline-none">
                                <option value="none">None</option>
                                <option value="completion">Completion Status</option>
                                <option value="quality">Quality</option>
                                <option value="decade">Decade</option>
                                <option value="network">Network/Studio</option>
                                <option value="folder">Folder Location</option>
                            </select>
                        </div>

                        <div class="space-y-2">
                            <label class="text-surface-400 text-xs font-medium uppercase tracking-wide">Then by</label>
                            <select id="secondary-sort-select"
                                    class="w-full h-10 bg-surface-900/60 text-white text-sm px-3 rounded-xl border border-white/10 focus:border-primary-500 outline-none">
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="completion-desc">Completion %</option>
                                <option value="year-desc">Year</option>
                                <option value="episodes-desc">Episode Count</option>
                            </select>
                        </div>

                        <div class="flex items-end">
                            <label class="flex items-center gap-3 text-surface-300 cursor-pointer hover:text-white transition-colors h-10">
                                <div class="relative">
                                    <input type="checkbox" id="reverse-sort" class="sr-only peer">
                                    <div class="w-10 h-6 bg-surface-700 rounded-full peer-checked:bg-primary-500 transition-colors"></div>
                                    <div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4"></div>
                                </div>
                                <span class="text-sm">Reverse order</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Progress Bar -->
        <div id="progress-container" class="glass-effect rounded-2xl p-6 mb-8 hidden">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="animate-spin rounded-full h-8 w-8 border-2 border-primary-500/30 border-t-primary-500"></div>
                    <span class="text-white font-semibold">Analyzing Library...</span>
                </div>
                <span id="progress-text" class="text-surface-400 font-mono">0%</span>
            </div>
            <div class="w-full bg-surface-800 rounded-full h-2 overflow-hidden">
                <div id="progress-bar" class="progress-bar h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>

        <!-- Series Grid -->
        <div id="series-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Series cards will be inserted here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="text-center py-20">
            <div class="w-24 h-24 mx-auto mb-6 rounded-2xl bg-surface-800/50 flex items-center justify-center">
                <i data-lucide="film" class="w-12 h-12 text-surface-500"></i>
            </div>
            <h3 class="text-xl font-semibold text-white mb-2">No Series Loaded</h3>
            <p class="text-surface-400 mb-6">Click "Scan Library" to load your Plex database</p>
            <button onclick="document.getElementById('scan-library-btn').click()" class="btn-primary px-6 py-3 rounded-xl inline-flex items-center space-x-2">
                <i data-lucide="database" class="w-5 h-5"></i>
                <span>Scan Library</span>
            </button>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="glass-effect rounded-2xl p-8 text-center max-w-sm mx-4">
            <div class="animate-spin rounded-full h-16 w-16 border-4 border-primary-500/30 border-t-primary-500 mx-auto mb-4"></div>
            <p class="text-white font-semibold">Loading Database...</p>
            <p class="text-surface-400 text-sm mt-2">This may take a few moments</p>
        </div>
    </div>
    
    <!-- Initialize critical functions first -->
    <script src="js/init-settings.js"></script>
    
    <!-- Event Delegation System DISABLED - using button-fix.js instead -->
    <!-- <script src="js/event-delegation.js"></script> -->
    
    <!-- Other scripts -->
    <script src="js/retry-manager.js"></script>
    <script src="js/api-retry-wrapper.js"></script>
    <script src="js/retry-settings-ui.js"></script>
    <script src="js/export-manager.js"></script>
    <script src="js/statistics-manager.js"></script>
    <script src="js/websocket-client.js"></script>
    <script src="js/audio-generator.js"></script>
    <script src="js/advanced-search.js"></script>
    <script src="js/app.js?v=2.5.1"></script>
    <script src="js/pdf-export.js"></script>
    
    <!-- CRITICAL: Direct button fix - MUST BE LAST -->
    <script src="js/button-fix.js"></script>

    <!-- Initialize Lucide Icons -->
    <script>
        // Initialize Lucide icons on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });

        // Re-initialize icons when DOM changes (for dynamically added content)
        // Using debounce to prevent infinite loops (createIcons modifies DOM which triggers observer)
        let iconUpdateTimeout = null;
        let isUpdatingIcons = false;

        const iconObserver = new MutationObserver(function(mutations) {
            // Skip if we're currently updating icons (prevents infinite loop)
            if (isUpdatingIcons) return;

            // Check if any mutation contains unprocessed lucide icons
            const hasNewIcons = mutations.some(mutation => {
                return Array.from(mutation.addedNodes).some(node => {
                    if (node.nodeType === 1) {
                        return node.matches && node.matches('[data-lucide]') ||
                               node.querySelector && node.querySelector('[data-lucide]');
                    }
                    return false;
                });
            });

            if (!hasNewIcons) return;

            // Debounce icon creation
            clearTimeout(iconUpdateTimeout);
            iconUpdateTimeout = setTimeout(function() {
                if (typeof lucide !== 'undefined') {
                    isUpdatingIcons = true;
                    lucide.createIcons();
                    isUpdatingIcons = false;
                }
            }, 50);
        });

        // Start observing once DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            iconObserver.observe(document.body, {
                childList: true,
                subtree: true
            });
        });
    </script>
</body>
</html>