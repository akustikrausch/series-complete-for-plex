<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="ingress-path" content="">
    <title>Series Complete for Plex - Series Analyzer</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="favicon.svg">

    <!-- Tailwind CSS Play CDN -->
    <script src="https://cdn.tailwindcss.com/3.4.15"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&display=swap" rel="stylesheet">

    <!-- Design System -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'primary': {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b'
                        },
                        'surface': {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                            950: '#0a0a0a'
                        },
                        'app-dark': '#111827',
                        'app-darker': '#0a0a0a',
                        'app-gray': '#374151',
                        'app-light': '#9ca3af',
                        'app-white': '#f9fafb'
                    },
                    fontFamily: {
                        'sans': ['DM Sans', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'sans-serif']
                    },
                    backdropBlur: {
                        'xs': '2px',
                        'glass': '20px'
                    },
                    borderRadius: {
                        'glass': '16px',
                        '2xl': '1rem',
                        '3xl': '1.5rem'
                    },
                    animation: {
                        'glow-pulse': 'glow-pulse 3s ease-in-out infinite',
                        'fade-in': 'fade-in 0.4s ease-out',
                        'slide-up': 'slide-up 0.5s cubic-bezier(0.16, 1, 0.3, 1)',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        'glow-pulse': {
                            '0%, 100%': { opacity: '0.4' },
                            '50%': { opacity: '0.7' },
                        },
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'translateY(8px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'slide-up': {
                            '0%': { opacity: '0', transform: 'translateY(24px) scale(0.96)' },
                            '100%': { opacity: '1', transform: 'translateY(0) scale(1)' },
                        },
                        'shimmer': {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' },
                        },
                    }
                }
            }
        }
    </script>

    <style>
        /* ========================================
           Series Complete — Liquid Glass 2026
           Refined dark observatory aesthetic
           ======================================== */

        /* Base */
        body {
            background: #060a10;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Ambient background atmosphere */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 60% at 20% 10%, rgba(16, 185, 129, 0.06) 0%, transparent 60%),
                radial-gradient(ellipse 60% 50% at 80% 90%, rgba(6, 78, 59, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse 100% 80% at 50% 50%, rgba(17, 24, 39, 0.9) 0%, #060a10 70%);
            pointer-events: none;
            z-index: 0;
        }

        body > * {
            position: relative;
            z-index: 1;
        }

        /* Noise texture overlay */
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            opacity: 0.025;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 9999;
        }

        /* Glass Effect — Liquid Glass 2026 */
        .glass-effect {
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.07) 0%,
                rgba(255, 255, 255, 0.02) 100%
            );
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.09);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.08),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
        }

        .glass-card {
            background: linear-gradient(
                160deg,
                rgba(255, 255, 255, 0.05) 0%,
                rgba(255, 255, 255, 0.015) 100%
            );
            backdrop-filter: blur(16px) saturate(150%);
            -webkit-backdrop-filter: blur(16px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 16px;
            box-shadow:
                0 4px 24px rgba(0, 0, 0, 0.35),
                inset 0 1px 0 rgba(255, 255, 255, 0.04);
        }

        /* Primary Button — Emerald */
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-weight: 600;
            letter-spacing: -0.01em;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow:
                0 2px 8px rgba(16, 185, 129, 0.3),
                0 0 0 1px rgba(16, 185, 129, 0.15);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow:
                0 6px 20px rgba(16, 185, 129, 0.4),
                0 0 0 1px rgba(16, 185, 129, 0.3);
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        /* Secondary Button */
        .btn-secondary {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: #d1d5db;
            transition: all 0.25s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(16, 185, 129, 0.3);
            color: white;
        }

        /* Danger Button */
        .btn-danger {
            background: rgba(239, 68, 68, 0.12);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            transition: all 0.25s ease;
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
            color: #fecaca;
        }

        /* Focus Visible — Accessibility */
        :focus-visible {
            outline: 2px solid #10b981;
            outline-offset: 2px;
        }

        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        select:focus-visible {
            outline: 2px solid #10b981;
            outline-offset: 2px;
        }

        /* Series Card */
        .series-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            will-change: transform;
            contain: layout style paint;
        }

        .series-card:hover {
            transform: translateY(-3px);
            border-color: rgba(16, 185, 129, 0.25);
            box-shadow:
                0 16px 40px rgba(0, 0, 0, 0.45),
                0 0 0 1px rgba(16, 185, 129, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }

        /* Virtual scrolling container */
        #series-grid {
            contain: layout style;
        }

        /* Status Colors */
        .status-complete { color: #34d399; }
        .status-warning { color: #fbbf24; }
        .status-critical { color: #f87171; }
        .status-unknown { color: #9ca3af; }

        /* Filter Button Active State — Segmented Control */
        .filter-btn {
            position: relative;
            z-index: 1;
            transition: all 0.2s ease;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
        }

        .filter-btn:not(.active):hover {
            background: rgba(255, 255, 255, 0.06);
        }

        /* Status Pill Toggle (Filter Modal) */
        .status-pill {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: #9ca3af;
            cursor: pointer;
        }

        .status-pill.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
        }

        .status-pill:not(.active):hover {
            background: rgba(255, 255, 255, 0.06);
            color: white;
        }

        /* Filter Tag Toggle (Genre/Network pills) */
        .filter-tag.active {
            background: rgba(16, 185, 129, 0.15) !important;
            border-color: rgba(16, 185, 129, 0.4) !important;
            color: #34d399 !important;
        }

        /* Input Focus States */
        input:focus, select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
        }

        /* Progress Bar */
        .progress-bar {
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
        }

        /* Loading Spinner */
        .spinner {
            border-color: rgba(16, 185, 129, 0.2);
            border-top-color: #10b981;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(16, 185, 129, 0.4);
        }

        /* Stat counter glow */
        .stat-value {
            text-shadow: 0 0 20px currentColor;
        }

        /* Header divider line */
        .header-accent {
            background: linear-gradient(90deg, transparent 0%, rgba(16, 185, 129, 0.3) 50%, transparent 100%);
            height: 1px;
        }

        /* Empty state illustration */
        .empty-glow {
            background: radial-gradient(circle, rgba(16, 185, 129, 0.12) 0%, transparent 70%);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .series-card:hover {
                transform: none;
            }

            .btn-primary:hover,
            .btn-secondary:hover {
                transform: none;
            }

            header .container {
                padding: 0.75rem;
            }

            header h1 {
                font-size: 1.25rem;
            }

            #stat-series, #stat-complete, #stat-incomplete {
                font-size: 1rem;
            }

            .btn-primary, .btn-secondary {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }

            .filter-btn {
                white-space: nowrap;
                flex-shrink: 0;
            }

            .inline-flex:has(.filter-btn) {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                max-width: 100%;
            }

            .inline-flex:has(.filter-btn)::-webkit-scrollbar {
                display: none;
            }

            .series-card {
                padding: 1rem;
            }

            #pagination-controls {
                font-size: 0.875rem;
                padding: 0 0.5rem;
            }

            #pagination-controls button {
                padding: 0.5rem;
                min-width: 2.75rem;
                min-height: 2.75rem;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .filter-btn span {
                display: none;
            }

            .filter-btn i {
                margin: 0;
            }

            .filter-btn {
                padding: 0.5rem 0.75rem;
            }
        }

        /* Tablet Responsive */
        @media (min-width: 769px) and (max-width: 1024px) {
            header .container {
                padding: 1rem;
            }

            .series-card {
                padding: 1.25rem;
            }
        }

        /* Lucide Icon Styles */
        .lucide {
            width: 1.25rem;
            height: 1.25rem;
            stroke-width: 2;
        }

        .lucide-sm {
            width: 1rem;
            height: 1rem;
        }

        .lucide-lg {
            width: 1.5rem;
            height: 1.5rem;
        }

        /* Legacy compatibility classes */
        .plex-button { @apply btn-primary; }
        .plex-dark { background-color: #111827; }
        .plex-darker { background-color: #0a0a0a; }
        .plex-gray { background-color: #374151; }
        .text-plex-white { color: #f9fafb; }
        .text-plex-light { color: #9ca3af; }
        .bg-plex-darker { background-color: #0a0a0a; }
        .bg-plex-gray { background-color: #374151; }
        .border-plex-gray { border-color: #374151; }
    </style>
</head>
<body class="font-sans text-app-white min-h-screen antialiased">
    <!-- Header -->
    <header class="glass-effect sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 py-3 sm:py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="w-9 h-9 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center shadow-lg shadow-primary-500/20">
                        <i data-lucide="tv" class="w-5 h-5 sm:w-6 sm:h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg sm:text-xl font-bold text-white tracking-tight">Series Complete</h1>
                        <p class="text-[10px] sm:text-xs text-surface-500 font-medium tracking-wider uppercase">Plex Library Analyzer</p>
                    </div>
                </div>

                <!-- Stats — Desktop -->
                <div class="hidden md:flex items-center gap-6 lg:gap-8">
                    <div class="text-center group">
                        <div class="text-xl lg:text-2xl font-bold text-primary-400 stat-value tabular-nums" id="stat-series">0</div>
                        <div class="text-[10px] text-surface-500 font-medium uppercase tracking-wider">Series</div>
                    </div>
                    <div class="w-px h-8 bg-white/5"></div>
                    <div class="text-center">
                        <div class="text-xl lg:text-2xl font-bold text-emerald-400 stat-value tabular-nums" id="stat-complete">0</div>
                        <div class="text-[10px] text-surface-500 font-medium uppercase tracking-wider">Complete</div>
                    </div>
                    <div class="w-px h-8 bg-white/5"></div>
                    <div class="text-center">
                        <div class="text-xl lg:text-2xl font-bold text-amber-400 stat-value tabular-nums" id="stat-incomplete">0</div>
                        <div class="text-[10px] text-surface-500 font-medium uppercase tracking-wider">Incomplete</div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-1.5 sm:gap-2">
                    <button id="scan-library-btn" class="btn-primary px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl flex items-center gap-1.5 sm:gap-2 text-sm" aria-label="Scan Plex library for TV series" title="Scan your Plex library for TV series">
                        <i id="scan-icon" data-lucide="database" class="w-4 h-4"></i>
                        <div id="scan-spinner" class="hidden animate-spin rounded-full h-4 w-4 border-2 border-white/30 border-t-white"></div>
                        <span id="scan-text" class="hidden sm:inline font-semibold">Scan Library</span>
                        <span id="scan-text-short" class="sm:hidden font-semibold">Scan</span>
                    </button>

                    <button id="analyze-all-btn" class="btn-primary px-5 py-2.5 rounded-xl flex items-center gap-2 hidden text-sm" aria-label="Analyze all series for missing episodes" title="Analyze all series for missing episodes">
                        <i data-lucide="clipboard-list" class="w-4 h-4"></i>
                        <span class="font-semibold">Analyze All</span>
                    </button>

                    <div class="w-px h-6 bg-white/5 hidden sm:block"></div>

                    <button id="refresh-cache-btn" class="btn-secondary p-2 sm:p-2.5 rounded-xl" aria-label="Reload from cache" title="Reload from cache">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    </button>

                    <button id="insights-btn" class="btn-secondary px-2.5 sm:px-3.5 py-2 sm:py-2.5 rounded-xl flex items-center gap-2" aria-label="View library insights and statistics" title="View library insights and statistics">
                        <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                        <span class="hidden lg:inline text-sm font-medium">Insights</span>
                    </button>

                    <button id="settings-btn" class="btn-secondary p-2 sm:p-2.5 rounded-xl" aria-label="Open settings" title="Open application settings">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Accent line -->
        <div class="header-accent"></div>
    </header>

    <!-- Mobile Stats Bar -->
    <div class="md:hidden glass-effect border-b border-white/5">
        <div class="container mx-auto px-4 py-2.5">
            <div class="flex items-center justify-around">
                <div class="text-center">
                    <div class="text-base font-bold text-primary-400 tabular-nums" id="stat-series-mobile">0</div>
                    <div class="text-[9px] text-surface-500 font-medium uppercase tracking-wider">Series</div>
                </div>
                <div class="w-px h-6 bg-white/5"></div>
                <div class="text-center">
                    <div class="text-base font-bold text-emerald-400 tabular-nums" id="stat-complete-mobile">0</div>
                    <div class="text-[9px] text-surface-500 font-medium uppercase tracking-wider">Complete</div>
                </div>
                <div class="w-px h-6 bg-white/5"></div>
                <div class="text-center">
                    <div class="text-base font-bold text-amber-400 tabular-nums" id="stat-incomplete-mobile">0</div>
                    <div class="text-[9px] text-surface-500 font-medium uppercase tracking-wider">Incomplete</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Search and Filters -->
        <div class="space-y-3 mb-8">

            <!-- Row 1: Search Bar -->
            <div class="relative group">
                <i data-lucide="search" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-surface-500 group-focus-within:text-primary-400 transition-colors pointer-events-none"></i>
                <input type="text" id="search-input" placeholder="Search series by name..."
                       aria-label="Search series"
                       class="w-full h-11 pl-11 pr-4 bg-white/[0.03] backdrop-blur-xl rounded-xl text-white placeholder-surface-500 border border-white/[0.06] focus:border-primary-500/50 focus:bg-white/[0.05] transition-all text-sm">
            </div>

            <!-- Row 2: Filters + Actions -->
            <div class="flex flex-col sm:flex-row gap-2.5">
                <!-- Filter Segments -->
                <div class="inline-flex p-0.5 bg-white/[0.03] backdrop-blur-xl rounded-xl border border-white/[0.06] flex-shrink-0" role="group" aria-label="Filter series by completion status">
                    <button data-filter="all" class="filter-btn active px-3.5 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5" aria-pressed="true">
                        <i data-lucide="layers" class="w-3.5 h-3.5"></i>
                        <span>All</span>
                    </button>
                    <button data-filter="complete" class="filter-btn px-3.5 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 text-surface-400 hover:text-white" aria-pressed="false">
                        <i data-lucide="check-circle" class="w-3.5 h-3.5"></i>
                        <span>Complete</span>
                    </button>
                    <button data-filter="incomplete" class="filter-btn px-3.5 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 text-surface-400 hover:text-white" aria-pressed="false">
                        <i data-lucide="circle-dot" class="w-3.5 h-3.5"></i>
                        <span>Incomplete</span>
                    </button>
                    <button data-filter="critical" class="filter-btn px-3.5 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-1.5 text-surface-400 hover:text-white" aria-pressed="false">
                        <i data-lucide="alert-triangle" class="w-3.5 h-3.5"></i>
                        <span class="hidden sm:inline">Critical</span>
                    </button>
                </div>

                <div class="flex-1"></div>

                <!-- Action Buttons -->
                <div class="flex gap-2">
                    <!-- Filter button hidden: advanced search functions not operational -->
                    <button id="advanced-search-btn" aria-label="Advanced filters"
                            class="hidden h-9 px-3.5 bg-white/[0.03] backdrop-blur-xl text-surface-300 rounded-xl border border-white/[0.06] hover:border-primary-500/30 hover:text-white hover:bg-white/[0.05] transition-all text-sm font-medium flex items-center gap-1.5">
                        <i data-lucide="sliders-horizontal" class="w-3.5 h-3.5"></i>
                        <span class="hidden sm:inline">Filters</span>
                    </button>
                    <button id="export-btn" aria-label="Export data"
                            class="h-9 px-3.5 bg-white/[0.03] backdrop-blur-xl text-surface-300 rounded-xl border border-white/[0.06] hover:border-sky-500/30 hover:text-white hover:bg-white/[0.05] transition-all text-sm font-medium flex items-center gap-1.5">
                        <i data-lucide="download" class="w-3.5 h-3.5"></i>
                        <span class="hidden sm:inline">Export</span>
                    </button>
                </div>
            </div>

            <!-- Row 3: Sort Controls -->
            <div class="flex flex-col sm:flex-row gap-2.5 items-start sm:items-center">
                <div class="flex items-center gap-2.5">
                    <span class="text-surface-500 text-xs font-medium uppercase tracking-wider">Sort</span>
                    <select id="sort-select" aria-label="Sort series"
                            class="h-9 bg-white/[0.03] backdrop-blur-xl text-white text-sm px-3 pr-8 rounded-xl border border-white/[0.06] focus:border-primary-500/50 outline-none appearance-none cursor-pointer"
                            style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%236b7280%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3e%3cpolyline points=%276 9 12 15 18 9%27%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 8px center; background-size: 14px;">
                        <option value="name-asc">Name (A-Z)</option>
                        <option value="name-desc">Name (Z-A)</option>
                        <option value="completion-desc">Completion ↓</option>
                        <option value="completion-asc">Completion ↑</option>
                        <option value="episodes-desc">Episodes ↓</option>
                        <option value="episodes-asc">Episodes ↑</option>
                        <option value="year-desc">Year (Newest)</option>
                        <option value="year-asc">Year (Oldest)</option>
                        <option value="date-desc">Date (Newest)</option>
                        <option value="date-asc">Date (Oldest)</option>
                        <option value="quality-desc">Quality ↓</option>
                        <option value="missing-desc">Missing ↓</option>
                        <option value="missing-asc">Missing ↑</option>
                    </select>
                </div>

                <button id="advanced-sort-btn" aria-label="More sort options"
                        class="h-9 px-3.5 bg-white/[0.03] backdrop-blur-xl text-surface-400 hover:text-white rounded-xl border border-white/[0.06] hover:border-white/10 transition-all text-sm font-medium flex items-center gap-1.5">
                    <i data-lucide="settings-2" class="w-3.5 h-3.5"></i>
                    <span>More Options</span>
                </button>
            </div>

            <!-- Advanced Sort Panel (Hidden by default) -->
            <div id="advanced-sort-panel" class="hidden">
                <div class="p-4 bg-white/[0.02] backdrop-blur-xl rounded-xl border border-white/[0.06]">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="space-y-1.5">
                            <label class="text-surface-500 text-[10px] font-medium uppercase tracking-wider">Group by</label>
                            <select id="group-by-select" aria-label="Group series by"
                                    class="w-full h-9 bg-surface-900/40 text-white text-sm px-3 rounded-xl border border-white/[0.06] focus:border-primary-500/50 outline-none">
                                <option value="none">None</option>
                                <option value="completion">Completion Status</option>
                                <option value="quality">Quality</option>
                                <option value="decade">Decade</option>
                                <option value="network">Network/Studio</option>
                                <option value="folder">Folder Location</option>
                            </select>
                        </div>

                        <div class="space-y-1.5">
                            <label class="text-surface-500 text-[10px] font-medium uppercase tracking-wider">Then by</label>
                            <select id="secondary-sort-select" aria-label="Secondary sort"
                                    class="w-full h-9 bg-surface-900/40 text-white text-sm px-3 rounded-xl border border-white/[0.06] focus:border-primary-500/50 outline-none">
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="completion-desc">Completion %</option>
                                <option value="year-desc">Year</option>
                                <option value="date-desc">Date (Newest)</option>
                                <option value="episodes-desc">Episode Count</option>
                            </select>
                        </div>

                        <div class="flex items-end">
                            <label class="flex items-center gap-3 text-surface-400 cursor-pointer hover:text-white transition-colors h-9">
                                <div class="relative">
                                    <input type="checkbox" id="reverse-sort" class="sr-only peer">
                                    <div class="w-9 h-5 bg-surface-700 rounded-full peer-checked:bg-primary-500 transition-colors"></div>
                                    <div class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4 shadow-sm"></div>
                                </div>
                                <span class="text-sm">Reverse order</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div id="progress-container" class="glass-effect rounded-2xl p-5 mb-8 hidden">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <div class="animate-spin rounded-full h-5 w-5 border-2 border-primary-500/30 border-t-primary-500"></div>
                    <span class="text-white font-medium text-sm">Analyzing Library...</span>
                </div>
                <span id="progress-text" class="text-surface-400 font-mono text-sm tabular-nums">0%</span>
            </div>
            <div class="w-full bg-surface-800/80 rounded-full h-1.5 overflow-hidden">
                <div id="progress-bar" class="progress-bar h-1.5 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
        </div>

        <!-- Series Grid -->
        <div id="series-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 lg:gap-5">
            <!-- Series cards will be inserted here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="text-center py-24 sm:py-32 animate-fade-in">
            <div class="relative inline-block mb-8">
                <!-- Ambient glow -->
                <div class="absolute inset-0 -m-12 empty-glow rounded-full animate-glow-pulse"></div>
                <!-- Icon container -->
                <div class="relative w-20 h-20 sm:w-24 sm:h-24 mx-auto rounded-2xl bg-white/[0.03] border border-white/[0.06] flex items-center justify-center backdrop-blur-sm">
                    <i data-lucide="film" class="w-10 h-10 sm:w-12 sm:h-12 text-surface-600"></i>
                </div>
            </div>
            <h3 class="text-xl sm:text-2xl font-bold text-white mb-2 tracking-tight">No Series Loaded</h3>
            <p class="text-surface-500 mb-8 max-w-sm mx-auto text-sm leading-relaxed">
                Connect to your Plex database to discover and analyze your TV series library
            </p>
            <button onclick="document.getElementById('scan-library-btn').click()" class="btn-primary px-6 py-3 rounded-xl inline-flex items-center gap-2.5 text-sm" aria-label="Scan Plex library">
                <i data-lucide="database" class="w-4 h-4"></i>
                <span class="font-semibold">Scan Library</span>
            </button>
            <p class="mt-4 text-surface-600 text-xs">
                <kbd class="px-1.5 py-0.5 rounded bg-white/[0.04] border border-white/[0.08] font-mono text-[10px]">Ctrl</kbd>
                <span class="mx-0.5">+</span>
                <kbd class="px-1.5 py-0.5 rounded bg-white/[0.04] border border-white/[0.08] font-mono text-[10px]">S</kbd>
                <span class="ml-1.5">to scan</span>
            </p>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50" role="dialog" aria-modal="true" aria-label="Loading">
        <div class="glass-effect rounded-2xl p-8 text-center max-w-xs mx-4 animate-slide-up">
            <div class="animate-spin rounded-full h-12 w-12 border-[3px] border-primary-500/20 border-t-primary-500 mx-auto mb-5"></div>
            <p class="text-white font-semibold text-sm">Loading Database</p>
            <p class="text-surface-500 text-xs mt-1.5">This may take a few moments</p>
        </div>
    </div>

    <!-- Base path for HA ingress -->
    <script src="js/base-path.js"></script>

    <!-- Initialize critical functions first -->
    <script src="js/init-settings.js"></script>

    <!-- Other scripts -->
    <script src="js/retry-manager.js"></script>
    <script src="js/api-retry-wrapper.js"></script>
    <script src="js/retry-settings-ui.js"></script>
    <script src="js/export-manager.js"></script>
    <script src="js/statistics-manager.js"></script>
    <script src="js/websocket-client.js"></script>
    <script src="js/audio-generator.js"></script>
    <script src="js/advanced-search.js"></script>
    <script src="js/app.js?v=2.6.1"></script>
    <script src="js/pdf-export.js"></script>

    <!-- CRITICAL: Direct button fix - MUST BE LAST -->
    <script src="js/button-fix.js"></script>

    <!-- Initialize Lucide Icons -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Sync mobile stats with desktop stats
            const syncStats = () => {
                const pairs = [
                    ['stat-series', 'stat-series-mobile'],
                    ['stat-complete', 'stat-complete-mobile'],
                    ['stat-incomplete', 'stat-incomplete-mobile']
                ];
                pairs.forEach(([src, dst]) => {
                    const s = document.getElementById(src);
                    const d = document.getElementById(dst);
                    if (s && d) d.textContent = s.textContent;
                });
            };

            // Observe stat changes for mobile sync
            const statObserver = new MutationObserver(syncStats);
            ['stat-series', 'stat-complete', 'stat-incomplete'].forEach(id => {
                const el = document.getElementById(id);
                if (el) statObserver.observe(el, { childList: true, characterData: true, subtree: true });
            });
        });

        // Re-initialize icons when DOM changes
        let iconUpdateTimeout = null;
        let isUpdatingIcons = false;

        const iconObserver = new MutationObserver(function(mutations) {
            if (isUpdatingIcons) return;

            const hasNewIcons = mutations.some(mutation => {
                return Array.from(mutation.addedNodes).some(node => {
                    if (node.nodeType === 1) {
                        return node.matches && node.matches('[data-lucide]') ||
                               node.querySelector && node.querySelector('[data-lucide]');
                    }
                    return false;
                });
            });

            if (!hasNewIcons) return;

            clearTimeout(iconUpdateTimeout);
            iconUpdateTimeout = setTimeout(function() {
                if (typeof lucide !== 'undefined') {
                    isUpdatingIcons = true;
                    lucide.createIcons();
                    isUpdatingIcons = false;
                }
            }, 50);
        });

        document.addEventListener('DOMContentLoaded', function() {
            iconObserver.observe(document.body, {
                childList: true,
                subtree: true
            });
        });
    </script>
</body>
</html>
