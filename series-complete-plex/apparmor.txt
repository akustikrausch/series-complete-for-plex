#include <tunables/global>

profile series-complete-plex flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>

  # Capabilities needed by S6 overlay
  capability chown,
  capability dac_override,
  capability fowner,
  capability fsetid,
  capability kill,
  capability setgid,
  capability setuid,
  capability net_bind_service,

  # S6 overlay v3 init system
  /init rix,
  /command/** rix,
  /package/** rix,
  /etc/s6-overlay/** rix,
  /etc/services.d/** rix,
  /etc/cont-init.d/** rix,
  /etc/fix-attrs.d/** rix,

  # System binaries
  /bin/** rix,
  /sbin/** rix,
  /usr/bin/** rix,
  /usr/sbin/** rix,

  # Allow network access
  network inet stream,
  network inet dgram,
  network inet6 stream,
  network inet6 dgram,

  # System configuration (read-only)
  /etc/** r,

  # Application directory (read-only)
  /app/** r,
  /run.sh rix,

  # Node.js runtime
  /usr/bin/node ix,
  /usr/local/bin/node ix,

  # Persistent data directory (read-write)
  /data/** rw,

  # Temporary files
  /tmp/** rwk,

  # System libraries
  /lib/** rm,
  /usr/lib/** rm,

  # Proc and sys filesystem
  /proc/** r,
  /sys/** r,

  # Device access
  /dev/** rw,

  # Runtime directories (S6, bashio)
  /run/** rwk,
  /var/** rwk,

  # Signals
  signal,

  # Deny everything else by default
}
