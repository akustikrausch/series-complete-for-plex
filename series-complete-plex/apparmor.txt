#include <tunables/global>

profile series-complete-plex flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>

  # Allow network access (Plex API, TMDb, TheTVDB, OpenAI)
  network inet stream,
  network inet dgram,
  network inet6 stream,
  network inet6 dgram,

  # Allow DNS resolution
  /etc/resolv.conf r,
  /etc/hosts r,
  /etc/nsswitch.conf r,

  # Application directory (read-only)
  /app/** r,
  /app/node_modules/** r,
  /app/public/** r,

  # Node.js runtime
  /usr/bin/node ix,
  /usr/lib/node_modules/** r,

  # Persistent data directory (read-write)
  /data/** rw,

  # Temporary files
  /tmp/** rw,

  # System libraries
  /lib/** r,
  /usr/lib/** r,

  # Proc filesystem (Node.js needs this)
  /proc/sys/kernel/random/uuid r,
  /proc/*/status r,
  /proc/*/fd/ r,

  # Bashio / S6 overlay
  /usr/bin/bashio ix,
  /usr/lib/bashio/** r,
  /run/** rw,

  # Deny everything else by default
}
