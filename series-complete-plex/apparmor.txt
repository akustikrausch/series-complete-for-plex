#include <tunables/global>

profile series-complete-plex flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>

  # S6 overlay init system
  /init rix,
  /bin/** rix,
  /sbin/** rix,
  /usr/bin/** rix,
  /usr/sbin/** rix,
  /etc/** r,
  /etc/s6-overlay/** rix,
  /etc/services.d/** rix,
  /etc/cont-init.d/** rix,

  # Allow network access (Plex API, TMDb, TheTVDB, OpenAI)
  network inet stream,
  network inet dgram,
  network inet6 stream,
  network inet6 dgram,

  # Application directory (read-only)
  /app/** r,

  # Node.js runtime
  /usr/bin/node ix,
  /usr/lib/node_modules/** r,

  # Persistent data directory (read-write)
  /data/** rw,

  # Temporary files
  /tmp/** rw,

  # System libraries
  /lib/** r,
  /usr/lib/** r,

  # Proc filesystem (Node.js needs this)
  /proc/** r,

  # Bashio / S6 overlay runtime
  /usr/bin/bashio ix,
  /usr/lib/bashio/** r,
  /run/** rw,
  /var/run/** rw,

  # Device access
  /dev/null rw,
  /dev/urandom r,

  # Deny everything else by default
}
